<!DOCTYPE html>
<html lang="zh-tw">
<?php echo $__env->make('layout.head', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
<body>
<div class="wrapper">

    <?php echo $__env->make('layout.header', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>

    <div class="box">
        <table width="100%" border="0" cellpadding="0" cellspacing="0">
            <tr valign="top">
                <td class="td_1">
                    <!-- menu 區塊 Begin -->
                    <?php echo $__env->make('layout.menu', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
                            <!-- menu 區塊 End -->
                </td>
                <td class="td_2">
                    <!-- 內容 區塊 Begin -->

                    <!-- message 區塊 Begin -->
                    <?php echo $__env->make('layout.message', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
                            <!-- message 區塊 End -->


                    <!-- detail 區塊 Begin -->
                    <div class="detail_box">
                        <div class="steps_box">
                            <span class="title">步驟</span>
                            <span class="active">1</span>
                            <span>2</span>
                        </div>
                        <form id="book_id" method="POST" action="/books_edit/<?php echo e($book[0]->id); ?>"
                              enctype="multipart/form-data">
                            <?php echo Form::model($book[0],['method' => 'PATCH','route'=>['books.edit.post',$book[0]->id]]); ?>

                            <table width="100%" border="0" cellpadding="0" cellspacing="0">
                                <tr>
                                    <th>書名</th>
                                    <td>
                                        <?php foreach($languages as $language): ?>
                                            <?php if($language==$languages[0]): ?>
                                                <h3><?php echo e($language->language); ?></h3>

                                                <div>
                                                    <?php echo Form::text($language->id.'_book_name',$book[0]->book_name,['cols'=>'80','rows'=>'10','class'=>'v_01']); ?>

                                                </div>
                                            <?php elseif($book_i18n!=null && $book_i18n[$language->id-1]!=null ): ?>
                                                <h3><?php echo e($language->language); ?></h3>

                                                <div>
                                                    <?php echo Form::text($language->id.'_book_name',$book_i18n[$language->id-1]->book_name,['cols'=>'80','rows'=>'10','class'=>'v_01']); ?>

                                                </div>
                                            <?php else: ?>
                                                <h3><?php echo e($language->language); ?></h3>

                                                <div>
                                                    <?php echo Form::text($language->id.'_book_name',null,['cols'=>'80','rows'=>'10','class'=>'v_01']); ?>

                                                </div>
                                            <?php endif; ?>
                                        <?php endforeach; ?>
                                    </td>
                                </tr>
                                <tr>
                                    <th>書封(&#8226;)</th>
                                    <td>
                                        <img class="bookcover" src="<?php echo e(asset($book[0]->cover)); ?>"><BR/>

                                        <div>
                                            使用方式：
                                            <label><?php echo Form::radio('upload_option',true,true,['onclick'=>'chgShowField("group_02","pic");']); ?>

                                                上傳圖檔</label>
                                            <label><?php echo Form::radio('upload_option',false,false,['onclick'=>'chgShowField("group_02","url");']); ?>

                                                圖檔網址</label>
                                        </div>

                                        <div class="group_02 pic">上傳圖檔：<?php echo Form::file('upload_file'); ?></div>
                                        <div class="group_02 url" style="display:none;">
                                            圖檔網址： <?php echo Form::text('cover',null); ?></div>
                                        <div class="note_txt">圖檔尺寸大小不限制，前台會自動調整尺寸。</div>
                                    </td>
                                </tr>
                                <tr>
                                    <th>連結(&#8226;)</th>
                                    <td><?php echo Form::text('url',null); ?>


                                        <div class="note_txt">格式必須為網址(含http://)，例如:http://www.google.com.tw</div>
                                    </td>
                                </tr>
                                <tr>
                                    <th>是否顯示</th>
                                    <td>
                                        <label><?php echo Form::radio('view',true,['checked'=>true]); ?>是</label>
                                        <label><?php echo Form::radio('view',false); ?>否</label>
                                    </td>
                                </tr>
                                <tr>
                                    <th>排序</th>
                                    <td><?php echo Form::text('rand_id',null,['class'=>'v_00']); ?>


                                        <div class="note_txt">數字愈大，順序愈前面。</div>
                                    </td>
                                </tr>
                                <tr>
                                    <th>備註</th>
                                    <td><?php echo Form::textarea('note',null,['rows'=>'5']); ?></td>
                                </tr>
                                <tr>
                                    <th>&nbsp;</th>
                                    <td>
                                        <a class="btn_02"
                                           onClick="step(parseInt($('span.active').html())-1)">上一步</a>
                                        <a class="btn_02"
                                           onClick="step(parseInt($('span.active').html())+1)">下一步</a>
                                        <a class="btn_02"
                                           onClick="submit()">完成</a>
                                    </td>
                                </tr>
                            </table>
                            <?php echo Form::close(); ?>

                        </form>
                    </div>
                    <!-- detail 區塊 End -->

                    <!-- Note 區塊 Begin -->
                    <div class="detail_note">
                        <div class="detail_note_title">Note</div>
                        <div class="detail_note_content">
                            <span class="required">(&#8226;)</span>為必填欄位
                        </div>
                    </div>
                    <!-- Note 區塊 End -->

                    <!-- 內容 區塊 End -->
                </td>
            </tr>
        </table>
    </div>

    <?php echo $__env->make('layout.footer', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>

</div>

<!-- 執行javascript 區塊 Begin -->
<?php echo $__env->make('layout.javascript', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
        <!-- 執行javascript 區塊 End -->
<script>
    init();

    function init() {
        for (var i = 1; i <= 5; i++) {
            $("form table tr:eq(" + i + ")").hide();
        }

        var value = $("input[name='upload_option']:checked").val();
        var option = value != null && value.trim() != "" && value != "0" && value != 0;
        if (option) {
            chgShowField("group_02", "pic");
        } else {
            chgShowField("group_02", "url");
        }

        $("a.btn_02:eq(0)").hide();
        $("a.btn_02:eq(2)").hide();
    }

    function step(i) {
        switch (i) {
            case 1 :
                $("span.active").removeClass();
                $("div.steps_box span:eq(" + i + ")").addClass("active");
                $("form table tr:eq(0)").show();
                for (var i = 1; i <= 5; i++) {
                    $("form table tr:eq(" + i + ")").hide();
                }

                $("div.message").hide();
                $("a.btn_02:eq(0)").hide();
                $("a.btn_02:eq(1)").show();
                $("a.btn_02:eq(2)").hide();
                break;

            case 2:
                if ($("span.active").html() == "1") {
                    var book_name_ch = $("input[name='0_book_name']").val()
                    if (book_name_ch == null || book_name_ch.trim() == "") {
                        message_show("<p>．請輸入書名。</p>");
                        break;
                    }
                }

                $("span.active").removeClass();
                $("div.steps_box span:eq(" + i + ")").addClass("active");
                for (var i = 0; i <= 0; i++) {
                    $("form table tr:eq(" + i + ")").hide();
                }

                for (var i = 1; i <= 5; i++) {
                    $("form table tr:eq(" + i + ")").show();
                }

                message_hide();
                $("a.btn_02:eq(0)").show();
                $("a.btn_02:eq(1)").hide();
                $("a.btn_02:eq(2)").show();
                break;
        }
    }

    function submit() {
        var msg = "";
        var value = $("input[name='upload_option']:checked").val();
        var option = value != null && value.trim() != "" && value != "0" && value != 0;
        var db_option = "<?php echo e($book[0]->upload_option); ?>" == "1";

        if (db_option && option) {
            if ($("input[name='upload_file']").val() != null && $("input[name='upload_file']").val() != "") {
                if (window.FileReader && window.Blob) {
                    var mime = document.getElementsByName('upload_file')[0].files[0].type;
                    if (mime != "image/png" && mime != "image/jpeg" && mime != "image/gif") {
                        msg = msg.concat("<p>．請上傳書封。</p>");
                    }
                }
            }

        } else if (db_option && !option) {
            if ($('input[name="cover"]').val() == null || $('input[name="cover"]').val().trim() == "") {
                msg = msg.concat("<p>．請輸入書封。</p>");
            } else {
                if (!$('input[name="cover"]').val().match(/^http([s]?):\/\/.*/)) {
                    msg = msg.concat("<p>．圖檔網址格式必須為網址(含http://)。</p>");
                }
            }
        } else if (!db_option && option) {
            if ($("input[name='upload_file']").val() == null || $("input[name='upload_file']").val() == "") {
                msg = msg.concat("<p>．請上傳書封。</p>");
            } else {
                if (window.FileReader && window.Blob) {
                    var mime = document.getElementsByName('upload_file')[0].files[0].type;
                    if (mime != "image/png" && mime != "image/jpeg" && mime != "image/gif") {
                        msg = msg.concat("<p>．請上傳書封。</p>");
                    }
                }
            }
        } else {
            if ($('input[name="cover"]').val() == null || $('input[name="cover"]').val().trim() == "") {
                msg = msg.concat("<p>．請輸入書封。</p>");
            } else {
                if (!$('input[name="cover"]').val().match(/^http([s]?):\/\/.*/)) {
                    msg = msg.concat("<p>．圖檔網址格式必須為網址(含http://)。</p>");
                }
            }
        }

        if ($('input[name="url"]').val() == null || $('input[name="url"]').val().trim() == "") {
            msg = msg.concat("<p>．請輸入連結。</p>");
        } else {
            if (!$('input[name="url"]').val().match(/^http([s]?):\/\/.*/)) {
                msg = msg.concat("<p>．連結格式必須為網址(含http://)。</p>");
            }
        }

        if (msg != "") {
            message_show(msg);
        } else {
            document.getElementById('book_id').submit();
        }
    }
</script>
</body>
</html>